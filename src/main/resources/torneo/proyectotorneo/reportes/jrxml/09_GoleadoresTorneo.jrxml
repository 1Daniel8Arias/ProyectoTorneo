<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports
              http://jasperreports.sourceforge.net/xsd/jasperreport.xsd"
              name="GoleadoresTorneo" pageWidth="595" pageHeight="842"
              columnWidth="535" leftMargin="30" rightMargin="30"
              topMargin="20" bottomMargin="20">

    <style name="Title" fontSize="24" isBold="true"/>
    <style name="Column header" fontSize="10" isBold="true"/>
    <style name="Detail" fontSize="9"/>

    <queryString>
        <![CDATA[SELECT 
            j.id_jugador,
            j.nombre || ' ' || j.apellido AS jugador,
            e.nombre AS equipo,
            j.posicion,
            SUM(g.numero_goles) AS total_goles,
            COUNT(DISTINCT g.id_partido) AS partidos_con_gol
        FROM jugador j
        INNER JOIN gol g ON j.id_jugador = g.id_jugador
        LEFT JOIN equipo e ON j.id_equipo = e.id_equipo
        GROUP BY j.id_jugador, j.nombre, j.apellido, e.nombre, j.posicion
        HAVING SUM(g.numero_goles) > 0
        ORDER BY SUM(g.numero_goles) DESC, j.apellido]]>
    </queryString>

    <field name="ID_JUGADOR" class="java.math.BigDecimal"/>
    <field name="JUGADOR" class="java.lang.String"/>
    <field name="EQUIPO" class="java.lang.String"/>
    <field name="POSICION" class="java.lang.String"/>
    <field name="TOTAL_GOLES" class="java.math.BigDecimal"/>
    <field name="PARTIDOS_CON_GOL" class="java.math.BigDecimal"/>

    <variable name="TOTAL_GOLES_TORNEO" class="java.math.BigDecimal" calculation="Sum">
        <variableExpression><![CDATA[$F{TOTAL_GOLES}]]></variableExpression>
    </variable>

    <variable name="RANKING" class="java.lang.Integer" calculation="Count">
        <variableExpression><![CDATA[$F{ID_JUGADOR}]]></variableExpression>
    </variable>

    <title>
        <band height="100">
            <rectangle>
                <reportElement x="0" y="0" width="535" height="95" backcolor="#FFFFCC"/>
            </rectangle>
            <staticText>
                <reportElement style="Title" x="0" y="15" width="535" height="40" forecolor="#FF6600"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font size="28" isBold="true"/>
                </textElement>
                <text><![CDATA[TABLA DE GOLEADORES]]></text>
            </staticText>
            <staticText>
                <reportElement x="0" y="55" width="535" height="25" forecolor="#666666"/>
                <textElement textAlignment="Center">
                    <font size="13" isBold="true"/>
                </textElement>
                <text><![CDATA[Torneo Colombiano 2025]]></text>
            </staticText>
            <textField pattern="dd/MM/yyyy HH:mm">
                <reportElement x="435" y="80" width="100" height="15"/>
                <textElement textAlignment="Right">
                    <font size="7"/>
                </textElement>
                <textFieldExpression><![CDATA[new java.util.Date()]]></textFieldExpression>
            </textField>
        </band>
    </title>

    <columnHeader>
        <band height="40">
            <staticText>
                <reportElement style="Column header" mode="Opaque" x="0" y="10" width="40" height="30" backcolor="#FFE6CC"/>
                <box>
                    <pen lineWidth="0.5"/>
                </box>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font size="9"/>
                </textElement>
                <text><![CDATA[Pos.]]></text>
            </staticText>
            <staticText>
                <reportElement style="Column header" mode="Opaque" x="40" y="10" width="150" height="30" backcolor="#FFE6CC"/>
                <box>
                    <pen lineWidth="0.5"/>
                </box>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font size="9"/>
                </textElement>
                <text><![CDATA[Jugador]]></text>
            </staticText>
            <staticText>
                <reportElement style="Column header" mode="Opaque" x="190" y="10" width="120" height="30" backcolor="#FFE6CC"/>
                <box>
                    <pen lineWidth="0.5"/>
                </box>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font size="9"/>
                </textElement>
                <text><![CDATA[Equipo]]></text>
            </staticText>
            <staticText>
                <reportElement style="Column header" mode="Opaque" x="310" y="10" width="75" height="30" backcolor="#FFE6CC"/>
                <box>
                    <pen lineWidth="0.5"/>
                </box>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font size="9"/>
                </textElement>
                <text><![CDATA[PosiciÃ³n]]></text>
            </staticText>
            <staticText>
                <reportElement style="Column header" mode="Opaque" x="385" y="10" width="75" height="30" backcolor="#FFE6CC"/>
                <box>
                    <pen lineWidth="0.5"/>
                </box>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font size="9"/>
                </textElement>
                <text><![CDATA[Part. con Gol]]></text>
            </staticText>
            <staticText>
                <reportElement style="Column header" mode="Opaque" x="460" y="10" width="75" height="30" backcolor="#FFE6CC"/>
                <box>
                    <pen lineWidth="0.5"/>
                </box>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font size="10" isBold="true"/>
                </textElement>
                <text><![CDATA[GOLES]]></text>
            </staticText>
        </band>
    </columnHeader>

    <detail>
        <band height="30">
            <!-- PosiciÃ³n destacada para top 3 -->
            <textField>
                <reportElement x="0" y="0" width="40" height="30" backcolor="#FFD700">
                    <printWhenExpression><![CDATA[$V{RANKING} == 1]]></printWhenExpression>
                </reportElement>
                <box>
                    <pen lineWidth="0.5"/>
                </box>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font size="14" isBold="true"/>
                </textElement>
                <textFieldExpression><![CDATA["ðŸ¥‡"]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="0" y="0" width="40" height="30" backcolor="#C0C0C0">
                    <printWhenExpression><![CDATA[$V{RANKING} == 2]]></printWhenExpression>
                </reportElement>
                <box>
                    <pen lineWidth="0.5"/>
                </box>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font size="14" isBold="true"/>
                </textElement>
                <textFieldExpression><![CDATA["ðŸ¥ˆ"]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="0" y="0" width="40" height="30" backcolor="#CD7F32">
                    <printWhenExpression><![CDATA[$V{RANKING} == 3]]></printWhenExpression>
                </reportElement>
                <box>
                    <pen lineWidth="0.5"/>
                </box>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font size="14" isBold="true"/>
                </textElement>
                <textFieldExpression><![CDATA["ðŸ¥‰"]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="0" y="0" width="40" height="30">
                    <printWhenExpression><![CDATA[$V{RANKING} > 3]]></printWhenExpression>
                </reportElement>
                <box>
                    <pen lineWidth="0.5"/>
                </box>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font size="10" isBold="true"/>
                </textElement>
                <textFieldExpression><![CDATA[$V{RANKING}]]></textFieldExpression>
            </textField>

            <textField>
                <reportElement x="40" y="0" width="150" height="30"/>
                <box leftPadding="5">
                    <pen lineWidth="0.5"/>
                </box>
                <textElement verticalAlignment="Middle">
                    <font size="9" isBold="true"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{JUGADOR}]]></textFieldExpression>
            </textField>
            <textField isBlankWhenNull="true">
                <reportElement x="190" y="0" width="120" height="30"/>
                <box leftPadding="5">
                    <pen lineWidth="0.5"/>
                </box>
                <textElement verticalAlignment="Middle">
                    <font size="8"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{EQUIPO}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="310" y="0" width="75" height="30"/>
                <box>
                    <pen lineWidth="0.5"/>
                </box>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font size="8"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{POSICION}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="385" y="0" width="75" height="30"/>
                <box>
                    <pen lineWidth="0.5"/>
                </box>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font size="9"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{PARTIDOS_CON_GOL}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="460" y="0" width="75" height="30" forecolor="#FF6600"/>
                <box>
                    <pen lineWidth="0.5"/>
                </box>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font size="16" isBold="true"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{TOTAL_GOLES}]]></textFieldExpression>
            </textField>
        </band>
    </detail>

    <summary>
        <band height="60">
            <line>
                <reportElement x="0" y="5" width="535" height="1"/>
                <graphicElement>
                    <pen lineWidth="2.0" lineColor="#FF6600"/>
                </graphicElement>
            </line>
            <staticText>
                <reportElement x="190" y="15" width="195" height="25" forecolor="#666666"/>
                <textElement textAlignment="Right" verticalAlignment="Middle">
                    <font size="12" isBold="true"/>
                </textElement>
                <text><![CDATA[Total de Goles en el Torneo:]]></text>
            </staticText>
            <textField>
                <reportElement x="385" y="15" width="150" height="25" forecolor="#FF6600"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font size="16" isBold="true"/>
                </textElement>
                <textFieldExpression><![CDATA[$V{TOTAL_GOLES_TORNEO}]]></textFieldExpression>
            </textField>
            <staticText>
                <reportElement x="0" y="45" width="535" height="15" forecolor="#999999"/>
                <textElement textAlignment="Center">
                    <font size="8" isItalic="true"/>
                </textElement>
                <text><![CDATA[* Tabla actualizada automÃ¡ticamente despuÃ©s de cada jornada]]></text>
            </staticText>
        </band>
    </summary>

</jasperReport>
